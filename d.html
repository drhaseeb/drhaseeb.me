<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>VTE</title>
	<!-- Bootstrap CDN -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
	
</head>
<body>
	<section class="" id="hero" style="linear-gradient(to left top, #bfc4e0, #737caf) 0 0 no-repeat;" data-bs-spy="scroll" data-bs-smooth-scroll="true">
		<div class="container py-5">
			<div class="row d-flex justify-content-center align-items-center">
				<div class="col-11 col-md-9 col-lg-7 col-xl-6">
					<div class="card">
						<div class="card-body">
							<form>
                <div class="mb-3">
                  <label class="form-label">Serial #</label>
                  <select class="form-select" id="serial"></select>
                </div>
                <div class="mb-3">
                  <label class="form-label">MR #</label>
                  <input class="form-control" name="MRNO" disabled>
                </div>
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input class="form-control" name="PATIENT_NAME" disabled>
                </div>
                <div class="d-none">
                  <input class="form-control" name="AGE" disabled>
                  <input class="form-control" name="GENDER" disabled>
                  <input class="form-control" name="BMI_ON_DIAGNOSIS_DATE" disabled>
                  <input class="form-control" name="DIAGNOSIS_DATE" disabled>
                  <input class="form-control" name="DATE_OF_DEATH" disabled>
                </div>
                <div class="mb-3">
                  <label class="form-label">Diagnosis</label>
                  <input class="form-control" name="CANCER_ICD" disabled>
                </div>
                <div class="mb-3">
                  <label class="form-label">Stage on Diagnosis</label>
                  <input class="form-control" name="STAGE_AT_PRESENTATION" disabled>
                </div>
                <div class="mb-3">
                  <label class="form-label">PE Diagnosis</label>
                  <input class="form-control" name="VTE_PE_ICD" disabled>
                </div>
                <div class="mb-3">
                  <label class="form-label">Diagnostic Method</label>
                  <input class="form-control" name="ICD_TYPE" disabled>
                </div>
                <div class="mb-3">
                  <label class="form-label">Treatment for PE</label>
                  <select class="form-select" name="TREATMENT">
                    <option value="DOAC">DOAC</option>
                    <option value="Enoxaparin">Enoxaparin</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Treatment Duration (in months)</label>
                  <input class="form-control" name="TREATMENT_DURATION">
                </div>
                <div class="mb-3">
                  <label class="form-label">Stage of Cancer after 6 months of PE</label>
                  <input class="form-control" name="6M_FU">
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
              </form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
  
<script src="https://apis.google.com/js/api.js"></script>

<script>
  var API_KEY = 'AIzaSyDdXpNR_fkUK2YYz4zpdcL0_thO1bGCFDU'; // Replace with your API key
  var SPREADSHEET_ID = '1npHjzp9Y8RxJhsb-ehdRrE9fIWLguzoH6WYaAYcThwo'; // Replace with your spreadsheet ID
  var RANGE = 'A1:N'; // Replace with your range of data

  function initClient() {
    gapi.client.init({
      apiKey: API_KEY,
      discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
    }).then(function () {
      // Get the data from the spreadsheet
      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: RANGE,
      }).then(function(response) {
        // Fill the bootstrap form with the data
        fillForm(response.result.values);
      }, function(error) {
        // Handle the error
        console.error(error);
      });
    });
  }

  // Load the API client on page load
  gapi.load('client', initClient);
</script>

<script>
  function fillForm(data) {
    // Get the form element
    var form = document.querySelector('form');
    // Get the serial selector element
    var select = document.getElementById('serial');
    // Clear the previous options
    select.innerHTML = '';
    // Create an option for each serial number
    for (var i = 1; i < data.length; i++) {
      var option = document.createElement('option');
      option.value = i;
      option.innerText = data[i][0];
      select.appendChild(option);
    }
    // Add a change event listener to the serial selector
    select.addEventListener('change', function() {
      // Fill the input fields with the selected row data
      fillRow(data, select.value);
    });
    // Fill the input fields with the first row data by default
    fillRow(data, 1);
    // Add a click event listener to the submit button
    var submit = document.getElementById('submit');
    submit.addEventListener('click', function(event) {
      // Prevent the default form submission
      event.preventDefault();
      // Update the spreadsheet with the form data
      updateSpreadsheet(data, select.value);
    });
  }

  // Fill the input fields with the row data
  function fillRow(data, serial) {
    // Loop through each column of data
    for (var i = 0; i < data[0].length; i++) {
      // Get the input element with the matching name
      var input = document.querySelector('[name="' + data[0][i] + '"]');
      // Set the input value to the row data
      input.value = data[serial][i];
    }
  }

  // Update the spreadsheet with the form data
  function updateSpreadsheet(data, serial) {
    // Get the form element
    var form = document.querySelector('form');
    // Get the form data as an array
    var formData = [];
    for (var i = 0; i < data[0].length; i++) {
      formData.push(form.elements[data[0][i]].value);
    }
    // Update the spreadsheet with the form data
    gapi.client.sheets.spreadsheets.values.update({
      spreadsheetId: SPREADSHEET_ID,
      range: 'A' + (parseInt(serial) + 1) + ':N' + (parseInt(serial) + 1),
      valueInputOption: 'USER_ENTERED',
      values: [formData]
    }).then(function(response) {
      // Display a success message
      alert('Spreadsheet updated successfully!');
    }, function(error) {
      // Display an error message
      alert('Spreadsheet update failed: ' + error.message);
    });
  }
</script>

</body>
</html>
